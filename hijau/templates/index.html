{% extends 'base.html' %}

{% block navbar %}
{% include 'navbar_guest.html' %}
{% endblock navbar %}

{% block content %}
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homepage</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-4">Daftar Kategori Jasa</h1>

        <!-- Filter Dropdown Kategori -->
        <div class="mb-4">
            <label for="category-dropdown" class="text-lg font-medium">Pilih Kategori:</label>
            <select id="category-dropdown" class="p-2 border rounded">
                <option value="">Pilih Kategori</option>
                {% for category in categories %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Search Bar for Subcategories -->
        <div class="mb-4">
            <label for="subcategory-search" class="text-lg font-medium">Cari Subkategori:</label>
            <input type="text" id="subcategory-search" class="p-2 border rounded" placeholder="Cari subkategori...">
        </div>

        <!-- Search Button -->
        <div class="mb-4">
            <button id="search-button" class="p-2 bg-blue-500 text-white rounded">Cari</button>
        </div>

        <!-- Daftar Subkategori per Kategori -->
        <div id="subcategory-list">
            {% for category in categories %}
                <div id="category-{{ category.id }}" class="subcategory-category">
                    <h2 class="text-xl font-bold mt-4 mb-2 category-title">{{ category.name }}</h2>
                    <ul>
                        {% for subcategory in subcategories %}
                            {% if subcategory.category_id == category.id %}
                                <li class="subcategory-item mb-2">
                                    <div>
                                        <!-- Tautan untuk pengguna biasa -->
                                        <a href="{% url 'subcategory_detail_user' category.id subcategory.name %}" class="text-blue-600 hover:underline">
                                            [User] {{ subcategory.name }} - {{ subcategory.description }}
                                        </a>
                                    </div>
                                    <div>
                                        <!-- Tautan untuk pekerja -->
                                        <a href="{% url 'subcategory_detail_worker' category.id subcategory.name %}" class="text-green-600 hover:underline">
                                            [Worker] {{ subcategory.name }} - {{ subcategory.description }}
                                        </a>
                                    </div>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>
            {% endfor %}
        </div>
    </div>

    <script>
        // Menangani filter kategori
        document.getElementById('category-dropdown').addEventListener('change', function() {
            var selectedCategory = this.value;
            var subcategoryList = document.getElementById('subcategory-list');
            
            // Menyembunyikan semua subkategori terlebih dahulu
            var subcategorySections = subcategoryList.querySelectorAll('.subcategory-category');
            subcategorySections.forEach(function(section) {
                section.style.display = 'none';
            });
            
            // Menampilkan subkategori sesuai kategori yang dipilih
            if (selectedCategory) {
                var selectedCategoryElement = document.getElementById('category-' + selectedCategory);
                selectedCategoryElement.style.display = 'block';
            } else {
                // Tampilkan semua subkategori jika tidak ada kategori yang dipilih
                subcategorySections.forEach(function(section) {
                    section.style.display = 'block';
                });
            }
        });

        // Menangani pencarian subkategori berdasarkan tombol klik
        document.getElementById('search-button').addEventListener('click', function() {
            var searchTerm = document.getElementById('subcategory-search').value.toLowerCase();
            var subcategorySections = document.querySelectorAll('.subcategory-category');
            
            subcategorySections.forEach(function(section) {
                var categoryTitle = section.querySelector('.category-title');
                var subcategoryItems = section.querySelectorAll('.subcategory-item');
                var categoryHasVisibleSubcategory = false;

                subcategoryItems.forEach(function(item) {
                    var subcategoryName = item.querySelector('a').textContent.toLowerCase();
                    if (subcategoryName.includes(searchTerm)) {
                        item.style.display = 'block';
                        categoryHasVisibleSubcategory = true;
                    } else {
                        item.style.display = 'none';
                    }
                });

                // Tampilkan atau sembunyikan kategori berdasarkan apakah ada subkategori yang cocok
                if (categoryHasVisibleSubcategory) {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
{% endblock %}